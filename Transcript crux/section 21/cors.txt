ğŸŒ CORS (Cross-Origin Resource Sharing) â€“ Express Configuration

CORS is one of the most common issues faced while building backend applications, especially when a frontend team connects to the backend using a browser.
This issue does NOT appear in tools like Postman or Insomnia because browsers enforce CORS, not backend servers or API tools.

ğŸ§  Why CORS Exists
Earlier, frontend and backend were hosted on the same server.
Now:
Frontend â†’ hosted on Vercel / Netlify / other
Backend â†’ hosted on AWS / DigitalOcean / other

Browsers block requests if:
- Domain changes
- Port changes
- Subdomain changes

Even a small change like localhost:3000 â†’ localhost:8000 is blocked.

This restriction is enforced by the browser for security reasons.

ğŸ‘‰ Handling CORS is the backend developerâ€™s responsibility.

ğŸ§± Middleware Concept
Middleware runs between:
Client request â†’ Backend logic

In Express, middleware is added using:
app.use()

Anything written using app.use() runs before routes.

ğŸ›  Basic Express Configurations (Before Routes)

1ï¸âƒ£ Accept JSON data
Used to accept JSON body from requests (Postman / frontend)

app.use(express.json({ limit: "16kb" }));

2ï¸âƒ£ Accept URL-encoded data
Used for data coming via URL (e.g. spaces â†’ %20)

app.use(express.urlencoded({ extended: true, limit: "16kb" }));

3ï¸âƒ£ Serve static files
Publicly accessible assets like images

app.use(express.static("public"));

ğŸ“¦ Installing CORS Package
CORS is handled using a Node.js package called cors.

npm install cors

âš ï¸ Be careful to install the correct package:
Package name: cors

ğŸ›  Using CORS in app.js

import cors from "cors";

app.use(
  cors({
    origin: process.env.CORS_ORIGIN
      ? process.env.CORS_ORIGIN.split(",")
      : ["http://localhost:5173"],
    credentials: true,
    methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"],
    allowedHeaders: ["Content-Type", "Authorization"],
  })
);

ğŸ§¾ Environment Variable (.env)
CORS_ORIGIN can be:
*
OR
https://example.com,https://another.com

This allows:
- Production frontend
- Staging frontend
- Development frontend

ğŸ¯ Key Points
- CORS is a browser security feature
- Postman does not show CORS errors
- Backend must explicitly allow frontend origins
- app.use(cors()) enables cross-origin communication
- Always configure CORS before routes
- Keep Express configuration in app.js, not index.js

ğŸ§  Final Takeaway
CORS tells the browser:
â€œI allow requests from these origins.â€

Thatâ€™s why Express configuration lives in app.js, keeping index.js clean and focused only on server startup.
